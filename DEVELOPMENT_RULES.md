# Shopify テーマ開発ルール 📋

## 概要

このドキュメントは、Shopifyテーマ開発における安全で効率的な開発ルールを定義します。ビジネスへの影響を最小限に抑えながら、高品質なテーマ開発を実現します。

## 🚨 絶対に守るべきルール

### **1. Liveテーマの直接編集禁止**

#### **❌ 絶対にやってはいけないこと**
```bash
# 危険なコマンド
shopify theme dev --live
shopify theme push --live  # テスト前
直接Liveテーマを編集
```

#### **✅ 正しいアプローチ**
```bash
# 安全な開発フロー
shopify theme dev          # 開発テーマで作業
# ↓ プレビューで確認
# ↓ 問題なければ本番公開
shopify theme push --live  # テスト完了後のみ
```

### **2. 開発環境の分離**

#### **テーマの種類と役割**
```
🟢 Development Theme (開発テーマ)
- 用途: 開発・テスト
- 安全性: 顧客への影響なし
- 操作: 自由に編集可能

🟡 Unpublished Theme (未公開テーマ)
- 用途: 新機能の準備
- 安全性: 顧客への影響なし
- 操作: 最終確認用

🔴 Live Theme (本番テーマ)
- 用途: 顧客が実際に見るテーマ
- 安全性: 直接編集禁止
- 操作: 開発テーマから公開のみ
```

## 🔧 開発ワークフロー

### **1. 開発開始**

#### **開発サーバー起動**
```bash
# 開発テーマで作業開始
shopify theme dev

# 確認事項
✅ ローカルサーバー: http://127.0.0.1:9292
✅ プレビューURL: 表示されるURL
✅ 開発テーマID: 確認
✅ 自動同期: 有効
```

#### **開発環境の確認**
```bash
# テーマ一覧確認
shopify theme list

# 現在のテーマ確認
# [development] が表示されていることを確認
```

### **2. 開発作業**

#### **ファイル編集時の注意**
```bash
# 自動同期されるファイル
✅ .liquid ファイル
✅ .json ファイル
✅ .css ファイル
✅ .js ファイル
✅ 画像ファイル

# 同期されないファイル
❌ .git/ ディレクトリ
❌ node_modules/
❌ .env ファイル
❌ 一時ファイル
```

#### **エラー時の対処**
```bash
# エラーが発生した場合
1. エラーメッセージを確認
2. ローカルで修正
3. 自動同期で反映
4. プレビューで確認
5. 問題がなければ継続
```

### **3. テスト・確認**

#### **プレビューでの確認**
```bash
# 確認すべき項目
✅ ページが正常に表示される
✅ 機能が正常に動作する
✅ レスポンシブデザイン
✅ パフォーマンス
✅ エラーがない
```

#### **ブラウザでの確認**
```bash
# 開発者ツールでの確認
✅ Console エラーがない
✅ Network エラーがない
✅ レスポンシブ表示
✅ アクセシビリティ
```

### **4. 本番公開**

#### **公開前の最終確認**
```bash
# チェックリスト
✅ すべての機能が動作する
✅ エラーがない
✅ パフォーマンスが良好
✅ レスポンシブデザイン
✅ アクセシビリティ対応
```

#### **安全な公開手順**
```bash
# 方法1: CLIから公開
shopify theme push --live

# 方法2: 管理画面から公開
1. Shopify管理画面にアクセス
2. オンラインストア > テーマ
3. 開発テーマを選択
4. 「公開」ボタンをクリック
```

## 📁 ファイル管理ルール

### **1. Gitとの連携**

#### **コミットルール**
```bash
# 機能追加時
git add .
git commit -m "feat: レビューセクションを追加"

# バグ修正時
git commit -m "fix: 商品表示エラーを修正"

# ドキュメント更新時
git commit -m "docs: 開発ルールを更新"
```

#### **ブランチ戦略**
```bash
# メインブランチ
main          # 本番環境

# 開発ブランチ
feature/*     # 新機能開発
fix/*         # バグ修正
docs/*        # ドキュメント更新
```

### **2. ファイル命名規則**

#### **セクションファイル**
```bash
# 命名規則
sections/product-reviews.liquid
sections/header-group.liquid
sections/footer.liquid

# ブロック命名
blocks/review-item.liquid
blocks/product-card.liquid
```

#### **アセットファイル**
```bash
# CSSファイル
assets/component-reviews.css
assets/section-product.css

# JavaScriptファイル
assets/product-reviews.js
assets/cart-utilities.js
```

## 🛡️ セキュリティルール

### **1. 機密情報の管理**

#### **環境変数**
```bash
# .env ファイル（Gitに含めない）
SHOPIFY_API_KEY=your_api_key
SHOPIFY_API_SECRET=your_api_secret
SHOPIFY_STORE_URL=your_store.myshopify.com
```

#### **API キー**
```bash
# 絶対にコードに直接書かない
❌ const apiKey = "sk_live_1234567890";

# 環境変数から取得
✅ const apiKey = process.env.SHOPIFY_API_KEY;
```

### **2. データ保護**

#### **顧客データ**
```bash
# 顧客情報の取り扱い
✅ 必要最小限の情報のみ使用
✅ 暗号化して保存
✅ アクセスログを記録
❌ 顧客データを外部に漏洩
```

## 📊 パフォーマンスルール

### **1. 画像最適化**

#### **画像サイズ**
```bash
# 推奨サイズ
商品画像: 800x800px
ヒーロー画像: 1920x600px
アイコン: 64x64px

# フォーマット
✅ WebP (推奨)
✅ JPEG (写真)
✅ PNG (透明背景)
```

#### **遅延読み込み**
```liquid
<!-- 遅延読み込みの実装 -->
<img src="{{ product.image | image_url: width: 800 }}" 
     loading="lazy" 
     alt="{{ product.title | escape }}">
```

### **2. CSS・JavaScript最適化**

#### **CSS最適化**
```css
/* 推奨事項 */
✅ 不要なCSSを削除
✅ メディアクエリを活用
✅ クリティカルCSSを分離
❌ インラインCSSを多用
```

#### **JavaScript最適化**
```javascript
// 推奨事項
✅ 非同期読み込み
✅ イベント委譲を活用
✅ 不要な処理を削除
❌ 重い処理をメインスレッドで実行
```

## 🔍 デバッグルール

### **1. エラー検出**

#### **開発時のエラー確認**
```bash
# Shopify CLI ログ
✅ 同期エラーの確認
✅ 構文エラーの確認
✅ ファイルパスの確認

# ブラウザ開発者ツール
✅ Console エラー
✅ Network エラー
✅ レンダリングエラー
```

#### **エラーログの記録**
```bash
# エラー発生時の対応
1. エラーメッセージを記録
2. 発生条件を特定
3. 再現手順を記録
4. 修正内容を記録
5. テスト結果を記録
```

### **2. テスト方法**

#### **機能テスト**
```bash
# テスト項目
✅ 商品表示
✅ カート機能
✅ 決済プロセス
✅ 検索機能
✅ フィルター機能
```

#### **ブラウザテスト**
```bash
# 対応ブラウザ
✅ Chrome (最新版)
✅ Firefox (最新版)
✅ Safari (最新版)
✅ Edge (最新版)
✅ モバイルブラウザ
```

## 📈 品質管理ルール

### **1. コードレビュー**

#### **レビュー項目**
```bash
# コード品質
✅ 可読性
✅ 保守性
✅ パフォーマンス
✅ セキュリティ
✅ アクセシビリティ
```

#### **レビュープロセス**
```bash
# レビュー手順
1. 自己レビュー
2. チームレビュー
3. テスト実行
4. 承認
5. マージ
```

### **2. ドキュメント管理**

#### **必須ドキュメント**
```bash
# プロジェクトドキュメント
✅ README.md
✅ DEVELOPMENT_RULES.md
✅ PROJECT_STRUCTURE.md
✅ API_DOCUMENTATION.md
✅ DEPLOYMENT_GUIDE.md
```

## 🚀 デプロイメントルール

### **1. 本番公開前チェック**

#### **最終確認チェックリスト**
```bash
# 機能確認
✅ すべてのページが表示される
✅ すべての機能が動作する
✅ エラーがない
✅ パフォーマンスが良好

# デザイン確認
✅ レスポンシブデザイン
✅ ブラウザ互換性
✅ アクセシビリティ
✅ ユーザビリティ
```

### **2. ロールバック手順**

#### **緊急時の対応**
```bash
# 問題発生時の手順
1. 問題を特定
2. 影響範囲を確認
3. ロールバック実行
4. 顧客への通知
5. 原因調査
6. 修正・再デプロイ
```

## 📞 緊急時連絡先

### **1. 問題発生時の連絡先**
```bash
# 技術サポート
Shopify Support: https://help.shopify.com/
Shopify Dev Docs: https://shopify.dev/

# 内部連絡先
開発チーム: [連絡先情報]
プロジェクトマネージャー: [連絡先情報]
```

### **2. エスカレーション手順**
```bash
# エスカレーション条件
1. サイトが完全に停止
2. 決済機能に問題
3. 顧客データに影響
4. セキュリティ問題
```

## まとめ

**開発ルールの重要性：**

1. **🛡️ 安全性** - ビジネスへの影響を最小限に
2. **⚡ 効率性** - 効率的な開発フロー
3. **📈 品質** - 高品質なテーマ開発
4. **🔄 保守性** - 長期的な保守性
5. **👥 チームワーク** - チーム開発の効率化

**このルールを守ることで、安全で効率的なShopifyテーマ開発が可能になります！** 🚀

---

**最終更新**: 2024年12月
**バージョン**: 1.0
**作成者**: 開発チーム 